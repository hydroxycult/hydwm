#  ██████╗ ██╗ ██████╗ ██████╗ ███╗   ███╗
#  ██╔══██╗██║██╔════╝██╔═══██╗████╗ ████║	
#  ██████╔╝██║██║     ██║   ██║██╔████╔██║	
#  ██╔═══╝ ██║██║     ██║   ██║██║╚██╔╝██║	
#  ██║     ██║╚██████╗╚██████╔╝██║ ╚═╝ ██║
#  ╚═╝     ╚═╝ ╚═════╝ ╚═════╝ ╚═╝     ╚═╝

#################################
#       General Settings        #
#################################
backend = "glx";
vsync = true;
detect-rounded-corners = true;
detect-client-opacity = true;
detect-transient = true;
log-level = "warn";

# Critical for Intel UHD 620 - prevents resize aberrations
use-damage = false;

# Prevents tearing during window operations - disable for Intel iGPU
unredir-if-possible = false;


# Force full redraws - prevents afterimages on Intel
dithered-present = false;

#################################
#     GLX Backend Optimizations #
#################################

# Maximize pipeline efficiency
xrender-sync-fence = true;

#################################
#     Shadows & Transparency    #
#################################
shadow = false;
shadow-radius = 0;
shadow-opacity = 0;

frame-opacity = 1.0;

#################################
#           Fading              #
#################################
fading = true;
fade-in-step = 0.028;
fade-out-step = 0.03;
fade-delta = 4;
no-fading-openclose = false;
no-fading-destroyed-argb = false;

#################################
#            Corners            #
#################################
corner-radius = 0;

#################################
#             Blur              #
#################################
blur:
{
  method = "dual_kawase";
  size = 100;
  deviation = 0;
}

#################################
#     Global Animations         #
#################################
animations = (
  # Default close animation - buttery smooth expo-out
  {
    triggers = ["close"];
    opacity = {
      curve = "cubic-bezier(0.22,1,0.36,1)";
      duration = 0.18;
      start = "window-raw-opacity-before";
      end = 0;
    };
    blur-opacity = "opacity";
    shadow-opacity = "opacity";
    scale-y = {
      curve = "cubic-bezier(0.22,1,0.36,1)";
      duration = 0.2;
      start = 1;
      end = 0.92;
    };
    scale-x = "scale-y";
    offset-x = "(1 - scale-x) / 2 * window-width";
    offset-y = "(1 - scale-y) / 2 * window-height";
    shadow-scale-x = "scale-x";
    shadow-scale-y = "scale-y";
    shadow-offset-x = "offset-x";
    shadow-offset-y = "offset-y";
  },

  # Default open animation - smooth expo-out with gentle overshoot
  {
    triggers = ["open"];
    opacity = {
      curve = "cubic-bezier(0.16,1,0.3,1)";
      duration = 0.22;
      start = 0;
      end = "window-raw-opacity";
    };
    blur-opacity = "opacity";
    shadow-opacity = "opacity";
    scale-y = {
      curve = "cubic-bezier(0.34,1.2,0.64,1)";
      duration = 0.28;
      start = 0.92;
      end = 1;
    };
    scale-x = "scale-y";
    offset-x = "(1 - scale-x) / 2 * window-width";
    offset-y = "(1 - scale-y) / 2 * window-height";
    shadow-scale-x = "scale-x";
    shadow-scale-y = "scale-y";
    shadow-offset-x = "offset-x";
    shadow-offset-y = "offset-y";
  },

  # Show/Hide animations - ultra quick
  {
    triggers = ["show"];
    opacity = {
      curve = "cubic-bezier(0.16,1,0.3,1)";
      duration = 0.15;
      start = 0;
      end = "window-raw-opacity";
    };
  },
  {
    triggers = ["hide"];
    opacity = {
      curve = "cubic-bezier(0.22,1,0.36,1)";
      duration = 0.15;
      start = "window-raw-opacity-before";
      end = 0;
    };
    blur-opacity = "opacity";
    shadow-opacity = "opacity";
  },

  # Geometry animation - disabled for resize to prevent artifacts on Intel iGPU
  # Only animate position changes (window moving/swapping), not resizing
  {
    triggers = ["geometry"];
    offset-x = {
      curve = "cubic-bezier(0.25, 1, 0.5, 1)";
      duration = 0.18;
      start = "window-x-before - window-x";
      end = 0;
    };
    offset-y = {
      curve = "cubic-bezier(0.25, 1, 0.5, 1)";
      duration = 0.18;
      start = "window-y-before - window-y";
      end = 0;
    };
  }
)

#################################
#            Rules              #
#################################
rules: (
  # Default rule
  {
    blur-background = false;
    fade = true;
  },

  # Normal windows
  {
    match = "window_type = 'normal'";
    fade = true;
    shadow = true;
  },

  # Dialog windows - snappy scale effect
  {
    match = "window_type = 'dialog'";
    shadow = true;
    animations = (
      {
        triggers = ["close"];
        opacity = {
          curve = "cubic-bezier(0.22,1,0.36,1)";
          duration = 0.16;
          start = "window-raw-opacity-before";
          end = 0;
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        scale-x = {
          curve = "cubic-bezier(0.22,1,0.36,1)";
          duration = 0.18;
          start = 1;
          end = 0.94;
        };
        scale-y = "scale-x";
        offset-x = "(1 - scale-x) / 2 * window-width";
        offset-y = "(1 - scale-y) / 2 * window-height";
      },
      {
        triggers = ["open"];
        opacity = {
          curve = "cubic-bezier(0.16,1,0.3,1)";
          duration = 0.2;
          start = 0;
          end = "window-raw-opacity";
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        scale-x = {
          curve = "cubic-bezier(0.34,1.2,0.64,1)";
          duration = 0.24;
          start = 0.94;
          end = 1;
        };
        scale-y = "scale-x";
        offset-x = "(1 - scale-x) / 2 * window-width";
        offset-y = "(1 - scale-y) / 2 * window-height";
      }
    )
  },

  # dmenu - slide down
  {
    match = "class_g = 'dmenu' || name = 'dmenu'";
    animations = (
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.22,1,0.36,1)";
          duration = 0.12;
          start = "window-raw-opacity-before";
          end = 0;
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-y = {
          curve = "cubic-bezier(0.22,1,0.36,1)";
          duration = 0.15;
          start = 0;
          end = -20;
        };
      },
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.16,1,0.3,1)";
          duration = 0.16;
          start = 0;
          end = "window-raw-opacity";
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-y = {
          curve = "cubic-bezier(0.34,1.2,0.64,1)";
          duration = 0.2;
          start = -20;
          end = 0;
        };
      }
    )
  },

  # Dunst notifications - slide in from right
  {
    match = "class_g = 'Dunst'";
    corner-radius = 0;
    animations = (
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.22,1,0.36,1)";
          duration = 0.14;
          start = "window-raw-opacity-before";
          end = 0;
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-x = {
          curve = "cubic-bezier(0.22,1,0.36,1)";
          duration = 0.18;
          start = 0;
          end = 80;
        };
      },
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.16,1,0.3,1)";
          duration = 0.2;
          start = 0;
          end = "window-raw-opacity";
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-x = {
          curve = "cubic-bezier(0.34,1.2,0.64,1)";
          duration = 0.26;
          start = 80;
          end = 0;
        };
      }
    )
  },

  # Polybar - instant
  {
    match = "class_i = 'polybar' || class_g = 'Polybar'";
    corner-radius = 0;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.06;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.06;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },

  # Eww widgets - instant
  {
    match = "class_i = 'eww' || class_g = 'eww-bar' || class_g = 'Eww'";
    corner-radius = 0;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.04;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.04;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },

  # Popup menus - instant
  {
    match = "window_type = 'popup_menu' || window_type = 'dropdown_menu' || window_type = 'menu'";
    corner-radius = 10;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.05;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.05;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },

  # Tooltips - instant
  {
    match = "window_type = 'tooltip'";
    corner-radius = 0;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.04;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.04;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },

  # Utility windows
  {
    match = "window_type = 'utility'";
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.08;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.08;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },

  # Dock windows
  {
    match = "window_type = 'dock'";
    corner-radius = 0;
    fade = true;
  },

  # Fullscreen - no effects for maximum performance
  {
    match = "fullscreen";
    corner-radius = 0;
  },

  # Terminals - no blur for performance
  {
    match = "class_g = 'st' || class_g = 'st-256color' || class_g = 'kitty' || class_g = 'FloaTerm'";
    blur-background = false;
  },

  # Special windows without shadows
  {
    match = "name = 'Notification' || "
            "class_g ?= 'Notify-osd' || "
            "class_g = 'jgmenu' || "
            "class_g = 'bspwm-scratch' || "
            "class_g = 'Spotify' || "
            "class_g = 'retroarch' || "
            "class_g = 'firefox' || "
            "class_g = 'Screenkey' || "
            "class_g = 'mpv' || "
            "class_g = 'Viewnior' || "
            "class_g = 'flameshot' || "
            "class_g = 'slop' || "
            "_GTK_FRAME_EXTENTS@";
  },

  # Special windows - no corner radius
  {
    match = "class_g = 'dwm' || "
            "class_g = 'Viewnior' || "
            "class_g = 'mpv' || "
            "class_g = 'retroarch'";
    corner-radius = 0;
  },

  # GNOME apps
  {
    match = "class_i *= 'gnome'";
    corner-radius = 16;
    blur-background = false;
  },

  # Screenshot tools - no animations
  {
    match = "class_g = 'slop' || class_g = 'Updating'";
    blur-background = false;
  },

  # Alt-tab - snappy
  {
    match = "class_i = 'alttab'";
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.06;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.06;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },

  # Session managers
  {
    match = "class_i = 'xfce4-session' || _NET_WM_WINDOW_OPACITY = 2147483647";
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.12;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.12;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  }
)
