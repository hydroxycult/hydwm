#  ██████╗ ██╗ ██████╗ ██████╗ ███╗   ███╗
#  ██╔══██╗██║██╔════╝██╔═══██╗████╗ ████║	
#  ██████╔╝██║██║     ██║   ██║██╔████╔██║	
#  ██╔═══╝ ██║██║     ██║   ██║██║╚██╔╝██║	
#  ██║     ██║╚██████╗╚██████╔╝██║ ╚═╝ ██║
#  ╚═╝     ╚═╝ ╚═════╝ ╚═════╝ ╚═╝     ╚═╝
#################################
#       General Settings        #
#################################
backend = "glx";
vsync = true;
detect-rounded-corners = true;
detect-client-opacity = true;
detect-transient = true;
log-level = "warn";
# Intel UHD 620 optimizations
use-damage = false;
unredir-if-possible = false;
dithered-present = false;
#################################
#     GLX Backend Optimizations #
#################################
xrender-sync-fence = true;
#################################
#     Shadows & Transparency    #
#################################
shadow = false;
shadow-radius = 0;
shadow-opacity = 0;
frame-opacity = 1.0;
#################################
#           Fading              #
#################################
fading = true;
fade-in-step = 0.04;
fade-out-step = 0.04;
fade-delta = 3;
no-fading-openclose = false;
no-fading-destroyed-argb = false;
#################################
#            Corners            #
#################################
corner-radius = 0;
#################################
#             Blur              #
#################################
blur:
{
  method = "dual_kawase";
  size = 8;
  strength = 4;
}
#################################
#     Aesthetic Animations      #
#################################
animations = (
  # Close - buttery smooth fade + subtle zoom out
  {
    triggers = ["close"];
    opacity = {
      curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
      duration = 0.18;
      start = "window-raw-opacity-before";
      end = 0;
    };
    blur-opacity = "opacity";
    shadow-opacity = "opacity";
    scale-x = {
      curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
      duration = 0.18;
      start = 1;
      end = 0.97;
    };
    scale-y = "scale-x";
    offset-x = "(1 - scale-x) / 2 * window-width";
    offset-y = "(1 - scale-y) / 2 * window-height";
    shadow-scale-x = "scale-x";
    shadow-scale-y = "scale-y";
    shadow-offset-x = "offset-x";
    shadow-offset-y = "offset-y";
  },
  # Open - aesthetic fade + zoom in like butter
  {
    triggers = ["open"];
    opacity = {
      curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
      duration = 0.22;
      start = 0;
      end = "window-raw-opacity";
    };
    blur-opacity = "opacity";
    shadow-opacity = "opacity";
    scale-x = {
      curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
      duration = 0.22;
      start = 0.97;
      end = 1;
    };
    scale-y = "scale-x";
    offset-x = "(1 - scale-x) / 2 * window-width";
    offset-y = "(1 - scale-y) / 2 * window-height";
    shadow-scale-x = "scale-x";
    shadow-scale-y = "scale-y";
    shadow-offset-x = "offset-x";
    shadow-offset-y = "offset-y";
  },
  # Show/Hide - INSTANT for workspace switching
  {
    triggers = ["show"];
    opacity = {
      curve = "linear";
      duration = 0.001;
      start = 0;
      end = "window-raw-opacity";
    };
  },
  {
    triggers = ["hide"];
    opacity = {
      curve = "linear";
      duration = 0.001;
      start = "window-raw-opacity-before";
      end = 0;
    };
  }
)
#################################
#            Rules              #
#################################
rules: (
  # Dunst notifications - MUST BE FIRST TO OVERRIDE DEFAULTS
  { 
    match = "class_g = 'Dunst'";
    corner-radius = 0;
    fade = false;
    shadow = false;
    animations = (
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.4, 0.0, 0.2, 1)";
          duration = 0.25;
          start = "window-raw-opacity-before";
          end = 0;
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-y = {
          curve = "cubic-bezier(0.4, 0.0, 1, 1)";
          duration = 0.25;
          start = 0;
          end = -60;
        };
      },
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.0, 0.0, 0.2, 1)";
          duration = 0.3;
          start = 0;
          end = "window-raw-opacity";
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-y = {
          curve = "cubic-bezier(0.68, -0.55, 0.265, 1.55)";
          duration = 0.6;
          start = -80;
          end = 0;
        };
      }
    )
  },
  # Default
  {
    blur-background = false;
    fade = true;
  },
  # Normal windows
  {
    match = "window_type = 'normal'";
    fade = true;
    shadow = true;
  },
  # Dialogs - aesthetic zoom
  {
    match = "window_type = 'dialog'";
    shadow = true;
    animations = (
      {
        triggers = ["close"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.16;
          start = "window-raw-opacity-before";
          end = 0;
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        scale-x = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.16;
          start = 1;
          end = 0.98;
        };
        scale-y = "scale-x";
        offset-x = "(1 - scale-x) / 2 * window-width";
        offset-y = "(1 - scale-y) / 2 * window-height";
      },
      {
        triggers = ["open"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.2;
          start = 0;
          end = "window-raw-opacity";
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        scale-x = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.2;
          start = 0.98;
          end = 1;
        };
        scale-y = "scale-x";
        offset-x = "(1 - scale-x) / 2 * window-width";
        offset-y = "(1 - scale-y) / 2 * window-height";
      }
    )
  },
  # dmenu - slide aesthetic
  {
    match = "class_g = 'dmenu' || name = 'dmenu'";
    animations = (
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.12;
          start = "window-raw-opacity-before";
          end = 0;
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-y = {
          curve = "cubic-bezier(0.5, 0, 0.5, 1)";
          duration = 0.14;
          start = 0;
          end = -15;
        };
      },
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.16;
          start = 0;
          end = "window-raw-opacity";
        };
        blur-opacity = "opacity";
        shadow-opacity = "opacity";
        offset-y = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.18;
          start = -15;
          end = 0;
        };
      }
    )
  },
  # Polybar - instant
  {
    match = "class_i = 'polybar' || class_g = 'Polybar'";
    corner-radius = 0;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.001;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.001;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },
  # Eww - instant
  {
    match = "class_i = 'eww' || class_g = 'eww-bar' || class_g = 'Eww'";
    corner-radius = 0;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.001;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.001;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },
  # Menus - quick aesthetic zoom
  {
    match = "window_type = 'popup_menu' || window_type = 'dropdown_menu' || window_type = 'menu'";
    corner-radius = 10;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.08;
          start = 0;
          end = "window-raw-opacity";
        };
        scale-x = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.1;
          start = 0.98;
          end = 1;
        };
        scale-y = "scale-x";
        offset-x = "(1 - scale-x) / 2 * window-width";
        offset-y = "(1 - scale-y) / 2 * window-height";
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.06;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },
  # Tooltips - instant
  {
    match = "window_type = 'tooltip'";
    corner-radius = 0;
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "linear";
          duration = 0.001;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "linear";
          duration = 0.001;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },
  # Utility - smooth
  {
    match = "window_type = 'utility'";
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.12;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.1;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },
  # Dock
  {
    match = "window_type = 'dock'";
    corner-radius = 0;
    fade = true;
  },
  # Fullscreen - no effects
  {
    match = "fullscreen";
    corner-radius = 0;
  },
  # Terminals - no blur
  {
    match = "class_g = 'st' || class_g = 'st-256color' || class_g = 'kitty' || class_g = 'FloaTerm'";
    blur-background = false;
  },
  # No shadows
  {
    match = "name = 'Notification' || "
            "class_g ?= 'Notify-osd' || "
            "class_g = 'jgmenu' || "
            "class_g = 'bspwm-scratch' || "
            "class_g = 'Spotify' || "
            "class_g = 'retroarch' || "
            "class_g = 'firefox' || "
            "class_g = 'Screenkey' || "
            "class_g = 'mpv' || "
            "class_g = 'Viewnior' || "
            "class_g = 'flameshot' || "
            "class_g = 'slop' || "
            "_GTK_FRAME_EXTENTS@";
  },
  # No corners
  {
    match = "class_g = 'dwm' || "
            "class_g = 'Viewnior' || "
            "class_g = 'mpv' || "
            "class_g = 'retroarch'";
    corner-radius = 0;
  },
  # GNOME
  {
    match = "class_i *= 'gnome'";
    corner-radius = 16;
    blur-background = false;
  },
  # Screenshots - no animations
  {
    match = "class_g = 'slop' || class_g = 'Updating'";
    blur-background = false;
  },
  # Alt-tab - quick zoom
  {
    match = "class_i = 'alttab'";
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.08;
          start = 0;
          end = "window-raw-opacity";
        };
        scale-x = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.1;
          start = 0.98;
          end = 1;
        };
        scale-y = "scale-x";
        offset-x = "(1 - scale-x) / 2 * window-width";
        offset-y = "(1 - scale-y) / 2 * window-height";
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.06;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  },
  # Session managers
  {
    match = "class_i = 'xfce4-session' || _NET_WM_WINDOW_OPACITY = 2147483647";
    animations = (
      {
        triggers = ["open", "show"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.14;
          start = 0;
          end = "window-raw-opacity";
        };
      },
      {
        triggers = ["close", "hide"];
        opacity = {
          curve = "cubic-bezier(0.25, 0.1, 0.25, 1)";
          duration = 0.12;
          start = "window-raw-opacity-before";
          end = 0;
        };
      }
    )
  }
)
